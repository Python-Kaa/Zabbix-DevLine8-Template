# Zabbix DevLine 8.3Template

## Описание
Шаблон Zabbix для наблюдения за сервером видеонаблюдения Линия 8 / DevLine 8.
Создавался на Zabbix 6.4, но должен работать и на более ранних версиях. Работает на основе HTTP-запросов с последующим разбором полученного JSON

### Собирает следующие параметры:
* Версия API сервера
* Статус лицензии (demo / коммерческая)
* Порты для подключения к серверу
* Имя сервера
* Используемая платформа (DVR / Linux)
* Версия ПО на сервере
* Список камер для LLD
* Список хранилищ для LLD
* ID сервера
* Модель видеорегистратора
* 

### Для камер, обнаруженных через LLD собираются:
* Имя камеры, указанное на сервере (по умолчанию, отключено)
* Административный статус (включено / выключено)
* Используемый IP-адрес камеры + порт
* Поток 1
  * Административный статус (включено / выключено)
  * Текущий статус (есть / нет)
  * Кодек
  * Разрешение
* Поток 2
  * Административный статус (включено / выключено)
  * Текущий статус (есть / нет)
  * Кодек
  * Разрешение

### Для хранилищ, обнаруженных через LLD собираются:
* Имя хранилища для отображения в элементах данных и триггерах
* Свободное место (получаем в мегабайтах и переводим в байты умножая на 1000000)
* Статус доступности (доступно / недоступно). Правда, протестировать "недоступное" хранилище не на чем
* Поток данных и очередь записи
* Глубина архива в днях
* Параметр, который согласно документации должен возвращать дату и время последней ошибки хранилища. Если такое поле в ответе не обнаружено, считаем, что всё ОК. Протестировать не удалось

### Триггеры обнауживают следующие ошибки:
* Пользователю запрещен доступ
* Пользователь не найден
* Изменилась версия сервера или ID сервера
* Не работают один или оба потока при административно включенной камере и потоках
* Хранилище перешло в состояние "недоступно"

### Макросы шаблона:
|Макрос|Значение по умолчанию|Описание|
|:-|:-:|:-|
|{$DEVLINE_API_VER}|82|Версия API, которая будет использоваться в запросах|
|{$DEVLINE_HTTP_PORT}|9786|Порт для HTTP-запросов|
|{$DEVLINE_LOGIN}|admin|Имя пользователя с правами Администрирование->Просмотр мониторинга и Администрирование->Настройка камер|
|{$DEVLINE_PASSWORD}|<пусто>|Пароль пользователя|

## Возможные проблемы
Если Zabbix не может получить данные, проверьте, что SELinux на сервере/прокси пропускает наружу HTTP-запросы от пользователя Zabbix. Если остальные шаблоны / элементы, использующие HTTP-запросы работают корректно, проверьте доступность и номер порта подключения на сервере.
