zabbix_export:
  version: '6.4'
  template_groups:
    - uuid: 7df96b18c230490a9a0a9e2307226338
      name: Templates
  templates:
    - uuid: 59d97b02f4974f8baaba574f7c6d5d75
      template: 'DevLine 8.3'
      name: 'DevLine 8.3'
      description: 'Если проверка web-сервисов на 80 порт проходит, а на другие нет - настраивать или отключать SELinux на сервере или прокси (откуда там у запросы будут идти)'
      groups:
        - name: Templates
      items:
        - uuid: 56bdfbc69f1741f595b4e6cb3058efda
          name: 'DevLine - Версия API'
          type: HTTP_AGENT
          key: 'devline.server[api_ver]'
          delay: 3h
          authtype: DIGEST
          username: '{$DEVLINE_LOGIN}'
          password: '{$DEVLINE_PASSWORD}'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.body.result.version.value
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 24h
          url: 'http://{HOST.CONN}:{$DEVLINE_HTTP_PORT}/rpc'
          status_codes: ''
          post_type: JSON
          posts: |
            {
               "method" : "get_version"
            }
          headers:
            - name: Accept
              value: application/json
            - name: Content-Type
              value: application/json
          request_method: POST
          output_format: JSON
          tags:
            - tag: Application
              value: Inventory
            - tag: Service
              value: DevLine
        - uuid: 44056cd8a4ec444cae1b687d7b7726a5
          name: 'DevLine - Список камер'
          type: HTTP_AGENT
          key: 'devline.server[camera.all]'
          delay: 3h
          value_type: CHAR
          trends: '0'
          authtype: DIGEST
          username: '{$DEVLINE_LOGIN}'
          password: '{$DEVLINE_PASSWORD}'
          preprocessing:
            - type: STR_REPLACE
              parameters:
                - '"body"'
                - '"data"'
          url: 'http://{HOST.CONN}:{$DEVLINE_HTTP_PORT}/cameras'
          status_codes: ''
          headers:
            - name: Accept
              value: application/json
            - name: Content-Type
              value: application/json
          output_format: JSON
          tags:
            - tag: Service
              value: DevLine
        - uuid: b237b28bded74684bcc13c37498d97f7
          name: 'DevLine - Состояние камер'
          type: HTTP_AGENT
          key: 'devline.server[camera.state]'
          delay: 5m
          value_type: CHAR
          trends: '0'
          authtype: DIGEST
          username: '{$DEVLINE_LOGIN}'
          password: '{$DEVLINE_PASSWORD}'
          url: 'http://{HOST.CONN}:{$DEVLINE_HTTP_PORT}/rpc'
          status_codes: ''
          post_type: JSON
          posts: |
            {
               "method" : "monitoring.get_media_state",
               "version" : {$DEVLINE_API_VER}
            }
          headers:
            - name: Accept
              value: application/json
            - name: Content-Type
              value: application/json
          request_method: POST
          output_format: JSON
          tags:
            - tag: Service
              value: DevLine
          triggers:
            - uuid: 2024681a2ca844559508f0cd2a0b41ff
              expression: 'find(/DevLine 8.3/devline.server[camera.state],,"like","\"message\" : \"forbidden\"")=1'
              name: 'DevLine - Forbidden'
              priority: HIGH
              description: 'Сервер вернул ошибку о том, что у пользователя недостаточно прав. Нужно проверить наличие права Администрирование -> Просмотр мониторинга'
            - uuid: 15abcb1e1f384bd8b127c5be15246743
              expression: 'last(/DevLine 8.3/devline.server[camera.state])="{\"body\":\"<HTML><HEAD><TITLE>401 - Unauthorized</TITLE></HEAD><BODY><H1>401 - Unauthorized</H1><P></P></BODY></HTML>\"}"'
              name: 'DevLine - User Unauthorized'
              priority: HIGH
              description: 'Сервер не нашел у себя пользователя с указанными именем и паролем'
        - uuid: 5ff8866bce324232ab829ea7c9a926e6
          name: 'DevLine - Данные сервера'
          type: HTTP_AGENT
          key: 'devline.server[features.all]'
          delay: 3h
          value_type: CHAR
          trends: '0'
          authtype: DIGEST
          username: '{$DEVLINE_LOGIN}'
          password: '{$DEVLINE_PASSWORD}'
          url: 'http://{HOST.CONN}:{$DEVLINE_HTTP_PORT}/rpc'
          status_codes: ''
          post_type: JSON
          posts: |
            {
               "method" : "get_server_info",
               "version" : {$DEVLINE_API_VER}
            }
          headers:
            - name: Accept
              value: application/json
            - name: Content-Type
              value: application/json
          request_method: POST
          output_format: JSON
          tags:
            - tag: Application
              value: Inventory
            - tag: Service
              value: DevLine
        - uuid: 1ce1b98e78e94f47890f9ef1a592cf4c
          name: 'DevLine - Demo State'
          type: DEPENDENT
          key: 'devline.server[features.demo]'
          delay: '0'
          valuemap:
            name: 'DevLine Demo State'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.body.result.info.demo
            - type: STR_REPLACE
              parameters:
                - 'false'
                - '0'
            - type: STR_REPLACE
              parameters:
                - 'true'
                - '1'
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 24h
          master_item:
            key: 'devline.server[features.all]'
          tags:
            - tag: Application
              value: Inventory
            - tag: Service
              value: DevLine
        - uuid: 840c0b2e5ebb43b59639d8b223ae3677
          name: 'DevLine - HTTP port'
          type: DEPENDENT
          key: 'devline.server[features.http]'
          delay: '0'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.body.result.info.network.ports.http
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 24h
          master_item:
            key: 'devline.server[features.all]'
          tags:
            - tag: Application
              value: Inventory
            - tag: Service
              value: DevLine
        - uuid: 4c72153cf2704c94982ef0f5034bf8a6
          name: 'DevLine - Server ID'
          type: DEPENDENT
          key: 'devline.server[features.id]'
          delay: '0'
          value_type: CHAR
          trends: '0'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.body.result.info.id
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 24h
          master_item:
            key: 'devline.server[features.all]'
          tags:
            - tag: Application
              value: Inventory
            - tag: Service
              value: DevLine
          triggers:
            - uuid: cf97cef6bb814d23b30f512af596d24c
              expression: 'change(/DevLine 8.3/devline.server[features.id])=1'
              name: 'Devline Server replaced'
              priority: INFO
        - uuid: d783c741db11401eb08bff3a7726f14f
          name: 'DevLine - Main port'
          type: DEPENDENT
          key: 'devline.server[features.main]'
          delay: '0'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.body.result.info.network.ports.main
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 24h
          master_item:
            key: 'devline.server[features.all]'
          tags:
            - tag: Application
              value: Inventory
            - tag: Service
              value: DevLine
        - uuid: ffc9d64d1aaa41c3bdd0622a87aa8cb7
          name: 'DevLine - Server Model'
          type: DEPENDENT
          key: 'devline.server[features.model]'
          delay: '0'
          value_type: CHAR
          trends: '0'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.body.result.info.model
              error_handler: CUSTOM_VALUE
              error_handler_params: 'Software DVR'
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 24h
          master_item:
            key: 'devline.server[features.all]'
          tags:
            - tag: Application
              value: Inventory
            - tag: Service
              value: DevLine
        - uuid: 820099e7b56b4131b1c1886b2f180b01
          name: 'DevLine - Server Name'
          type: DEPENDENT
          key: 'devline.server[features.name]'
          delay: '0'
          value_type: CHAR
          trends: '0'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.body.result.info.name
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 24h
          master_item:
            key: 'devline.server[features.all]'
          tags:
            - tag: Application
              value: Inventory
            - tag: Service
              value: DevLine
        - uuid: 9a44f51bfeec4b60b26a6be01eb66eb4
          name: 'DevLine - Ping port'
          type: DEPENDENT
          key: 'devline.server[features.ping]'
          delay: '0'
          value_type: CHAR
          trends: '0'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.body.result.info.network.ports.ping
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 24h
          master_item:
            key: 'devline.server[features.all]'
          tags:
            - tag: Application
              value: Inventory
            - tag: Service
              value: DevLine
        - uuid: 742bc6572b5641dbb91bcf7bc3ba0d02
          name: 'DevLine - RTSP port'
          type: DEPENDENT
          key: 'devline.server[features.rtsp]'
          delay: '0'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.body.result.info.network.ports.rtsp
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 24h
          master_item:
            key: 'devline.server[features.all]'
          tags:
            - tag: Application
              value: Inventory
            - tag: Service
              value: DevLine
        - uuid: 8338928e243e4a36b238ae60147d227b
          name: 'DevLine - Server Target'
          type: DEPENDENT
          key: 'devline.server[features.target]'
          delay: '0'
          value_type: CHAR
          trends: '0'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.body.result.info.target
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 24h
          master_item:
            key: 'devline.server[features.all]'
          tags:
            - tag: Application
              value: Inventory
            - tag: Service
              value: DevLine
        - uuid: 85c0ea7cf3bd4747aecbcf10a578b612
          name: 'DevLine - Server type'
          type: DEPENDENT
          key: 'devline.server[features.type]'
          delay: '0'
          value_type: CHAR
          trends: '0'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.body.result.info.type
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 24h
          master_item:
            key: 'devline.server[features.all]'
          tags:
            - tag: Application
              value: Inventory
            - tag: Service
              value: DevLine
        - uuid: e2e96253d45048868def6307ff86c84f
          name: 'DevLine - Server Version'
          type: DEPENDENT
          key: 'devline.server[features.version]'
          delay: '0'
          value_type: CHAR
          trends: '0'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.body.result.info.version.name
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 24h
          master_item:
            key: 'devline.server[features.all]'
          tags:
            - tag: Application
              value: Inventory
            - tag: Service
              value: DevLine
          triggers:
            - uuid: 3d2ea49cd42240e89f495e75987442a7
              expression: 'last(/DevLine 8.3/devline.server[features.version],#2)<>last(/DevLine 8.3/devline.server[features.version])'
              name: 'DevLine Version was changed'
              priority: INFO
              manual_close: 'YES'
        - uuid: 167f28f6acfd4af5826b2ca99a47ef19
          name: 'DevLine - Хранилища'
          type: HTTP_AGENT
          key: 'devline.server[storage.state]'
          delay: 5m
          value_type: CHAR
          trends: '0'
          authtype: DIGEST
          username: '{$DEVLINE_LOGIN}'
          password: '{$DEVLINE_PASSWORD}'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.body.result.state
            - type: STR_REPLACE
              parameters:
                - '{"storages":['
                - '{"data":['
          url: 'http://{HOST.CONN}:{$DEVLINE_HTTP_PORT}/rpc'
          status_codes: ''
          post_type: JSON
          posts: |
            {
               "method" : "monitoring.get_archive_state",
               "version" : {$DEVLINE_API_VER}
            }
          headers:
            - name: Accept
              value: application/json
            - name: Content-Type
              value: application/json
          request_method: POST
          output_format: JSON
          tags:
            - tag: Service
              value: DevLine
      discovery_rules:
        - uuid: 7249dc65b2ed4c3c9d27b44f94adca83
          name: 'Camera discovery'
          type: DEPENDENT
          key: 'devline.server[camera.discovery]'
          delay: '0'
          lifetime: 5d
          item_prototypes:
            - uuid: cc2b6c7008824c70a325eb27e123e211
              name: 'Devline - {#NAME} Admin State'
              type: DEPENDENT
              key: 'devline.server[camera.{#NUM}.admin.state]'
              delay: '0'
              valuemap:
                name: 'Devline Camera Admin State'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$.body.result.state.cameras.{#NUM}.enabled'
                - type: STR_REPLACE
                  parameters:
                    - 'true'
                    - '1'
                - type: STR_REPLACE
                  parameters:
                    - 'false'
                    - '0'
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 24h
              master_item:
                key: 'devline.server[camera.state]'
              tags:
                - tag: Camera
                  value: '{#NAME}'
                - tag: Service
                  value: DevLine
            - uuid: 945ba1ddd33742f782ef8d91dc851234
              name: 'Devline - Camera {#NUM} Name'
              type: DEPENDENT
              key: 'devline.server[camera.{#NUM}.name]'
              delay: '0'
              value_type: CHAR
              trends: '0'
              status: DISABLED
              discover: NO_DISCOVER
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$.data.[{#NUM}].name'
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 24h
              master_item:
                key: 'devline.server[camera.all]'
              tags:
                - tag: Camera
                  value: '{#NAME}'
                - tag: Service
                  value: DevLine
            - uuid: b930d120c2aa4ae8890b01f8f9270a4c
              name: 'DevLine - Состояние камеры {#NAME}'
              type: HTTP_AGENT
              key: 'devline.server[camera.{#NUM}.status]'
              delay: 3h
              value_type: CHAR
              trends: '0'
              authtype: DIGEST
              username: '{$DEVLINE_LOGIN}'
              password: '{$DEVLINE_PASSWORD}'
              url: 'http://{HOST.CONN}:{$DEVLINE_HTTP_PORT}/rpc'
              post_type: JSON
              posts: |
                {
                   "method" : "get_camera_config",
                   "params" : 
                   {
                      "camera" : "{#NUM}"
                   },
                   "version" : {$DEVLINE_API_VER}
                }
              headers:
                - name: Accept
                  value: application/json
                - name: Content-Type
                  value: application/json
              request_method: POST
              tags:
                - tag: Service
                  value: DevLine
            - uuid: 1b3c4f58017f4089a687840c998ccde2
              name: 'Devline - {#NAME} Stream1 Admin State'
              type: DEPENDENT
              key: 'devline.server[camera.{#NUM}.stream1.admin.state]'
              delay: '0'
              valuemap:
                name: 'Devline Camera Admin State'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$.body.result.state.cameras.{#NUM}.streams.video.enabled'
                - type: STR_REPLACE
                  parameters:
                    - 'true'
                    - '1'
                - type: STR_REPLACE
                  parameters:
                    - 'false'
                    - '0'
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 24h
              master_item:
                key: 'devline.server[camera.state]'
              tags:
                - tag: Camera
                  value: '{#NAME}'
                - tag: Service
                  value: DevLine
                - tag: Video
                  value: '{#NAME} stream 1'
            - uuid: a13d63b398b8436bb2a02b1c3af00f37
              name: 'Devline - {#NAME} Stream1 Codec'
              type: DEPENDENT
              key: 'devline.server[camera.{#NUM}.stream1.codec]'
              delay: '0'
              value_type: CHAR
              trends: '0'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.result.config.video_streams.video.codec
                - type: STR_REPLACE
                  parameters:
                    - '['
                    - ''
                - type: STR_REPLACE
                  parameters:
                    - ']'
                    - ''
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 24h
              master_item:
                key: 'devline.server[camera.{#NUM}.status]'
              tags:
                - tag: Camera
                  value: '{#NAME}'
                - tag: Service
                  value: DevLine
                - tag: Video
                  value: '{#NAME} stream 1'
            - uuid: 71f23980010b4bac990c5ab2f60122af
              name: 'Devline - {#NAME} Stream1 Resolution'
              type: DEPENDENT
              key: 'devline.server[camera.{#NUM}.stream1.resolution]'
              delay: '0'
              value_type: CHAR
              trends: '0'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.result.config.video_streams.video.resolution
                - type: STR_REPLACE
                  parameters:
                    - '['
                    - ''
                - type: STR_REPLACE
                  parameters:
                    - ']'
                    - ''
                - type: STR_REPLACE
                  parameters:
                    - ','
                    - x
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 24h
              master_item:
                key: 'devline.server[camera.{#NUM}.status]'
              tags:
                - tag: Camera
                  value: '{#NAME}'
                - tag: Service
                  value: DevLine
                - tag: Video
                  value: '{#NAME} stream 1'
            - uuid: f1784035957546c29404165dba179628
              name: 'Devline - {#NAME} Stream1 Status'
              type: DEPENDENT
              key: 'devline.server[camera.{#NUM}.stream1.status]'
              delay: '0'
              valuemap:
                name: 'DevLine Stream Status'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$.body.result.state.cameras.{#NUM}.streams.video.active'
                - type: STR_REPLACE
                  parameters:
                    - 'true'
                    - '1'
                - type: STR_REPLACE
                  parameters:
                    - 'false'
                    - '0'
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 24h
              master_item:
                key: 'devline.server[camera.state]'
              tags:
                - tag: Camera
                  value: '{#NAME}'
                - tag: Service
                  value: DevLine
                - tag: Video
                  value: '{#NAME} stream 1'
            - uuid: ce7a04d657104dafa6af0fffc4569d46
              name: 'Devline - {#NAME} Stream2 Admin State'
              type: DEPENDENT
              key: 'devline.server[camera.{#NUM}.stream2.admin.state]'
              delay: '0'
              valuemap:
                name: 'Devline Camera Admin State'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$.body.result.state.cameras.{#NUM}.streams.video2.enabled'
                - type: STR_REPLACE
                  parameters:
                    - 'true'
                    - '1'
                - type: STR_REPLACE
                  parameters:
                    - 'false'
                    - '0'
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 24h
              master_item:
                key: 'devline.server[camera.state]'
              tags:
                - tag: Camera
                  value: '{#NAME}'
                - tag: Service
                  value: DevLine
                - tag: Video
                  value: '{#NAME} stream 2'
            - uuid: 240711888ce344b0b8e7e83742be5a08
              name: 'Devline - {#NAME} Stream2 Codec'
              type: DEPENDENT
              key: 'devline.server[camera.{#NUM}.stream2.codec]'
              delay: '0'
              value_type: CHAR
              trends: '0'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.result.config.video_streams.video2.codec
                - type: STR_REPLACE
                  parameters:
                    - '['
                    - ''
                - type: STR_REPLACE
                  parameters:
                    - ']'
                    - ''
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 24h
              master_item:
                key: 'devline.server[camera.{#NUM}.status]'
              tags:
                - tag: Camera
                  value: '{#NAME}'
                - tag: Service
                  value: DevLine
                - tag: Video
                  value: '{#NAME} stream 2'
            - uuid: f01deab162994c37887a7aca5f3cdaf2
              name: 'Devline - {#NAME} Stream2 Resolution'
              type: DEPENDENT
              key: 'devline.server[camera.{#NUM}.stream2.resolution]'
              delay: '0'
              value_type: CHAR
              trends: '0'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.result.config.video_streams.video2.resolution
                - type: STR_REPLACE
                  parameters:
                    - '['
                    - ''
                - type: STR_REPLACE
                  parameters:
                    - ']'
                    - ''
                - type: STR_REPLACE
                  parameters:
                    - ','
                    - x
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 24h
              master_item:
                key: 'devline.server[camera.{#NUM}.status]'
              tags:
                - tag: Camera
                  value: '{#NAME}'
                - tag: Service
                  value: DevLine
                - tag: Video
                  value: '{#NAME} stream 2'
            - uuid: 4dc152d3be78499a8a9a88538fc067ea
              name: 'Devline - {#NAME} Stream2 Status'
              type: DEPENDENT
              key: 'devline.server[camera.{#NUM}.stream2.status]'
              delay: '0'
              valuemap:
                name: 'DevLine Stream Status'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$.body.result.state.cameras.{#NUM}.streams.video2.active'
                - type: STR_REPLACE
                  parameters:
                    - 'true'
                    - '1'
                - type: STR_REPLACE
                  parameters:
                    - 'false'
                    - '0'
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 24h
              master_item:
                key: 'devline.server[camera.state]'
              tags:
                - tag: Camera
                  value: '{#NAME}'
                - tag: Service
                  value: DevLine
                - tag: Video
                  value: '{#NAME} stream 2'
            - uuid: 5e94ce17951e4f21bf403359bb93fa08
              name: 'Devline - {#NAME} IP'
              type: DEPENDENT
              key: 'devline.server[camera.{#NUM}.url]'
              delay: '0'
              value_type: CHAR
              trends: '0'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.result.config.url
                - type: REGEX
                  parameters:
                    - '([\S]+)([@])([\S]+)'
                    - \3
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 24h
              master_item:
                key: 'devline.server[camera.{#NUM}.status]'
              tags:
                - tag: Camera
                  value: '{#NAME}'
                - tag: Service
                  value: DevLine
          trigger_prototypes:
            - uuid: 7491c52cd09f4d0490bc857332bd4c66
              expression: 'last(/DevLine 8.3/devline.server[camera.{#NUM}.admin.state])=1 and last(/DevLine 8.3/devline.server[camera.{#NUM}.stream1.admin.state])=1 and last(/DevLine 8.3/devline.server[camera.{#NUM}.stream1.status])=0 and last(/DevLine 8.3/devline.server[camera.{#NUM}.stream2.admin.state])=1 and last(/DevLine 8.3/devline.server[camera.{#NUM}.stream2.status])=0'
              name: 'DevLine - {#NAME} Fail'
              opdata: 'Camera - {ITEM.LASTVALUE1}, Stream1 - {ITEM.LASTVALUE3}, Stream2 - {ITEM.LASTVALUE5}'
              priority: AVERAGE
              tags:
                - tag: Camera
                  value: '{#NAME}'
            - uuid: b80b52787ab04f8dac77b7cf5e27725a
              expression: 'last(/DevLine 8.3/devline.server[camera.{#NUM}.admin.state])=1 and last(/DevLine 8.3/devline.server[camera.{#NUM}.stream1.admin.state])=1 and last(/DevLine 8.3/devline.server[camera.{#NUM}.stream1.status])=0'
              name: 'DevLine - {#NAME} Stream1 Fail'
              opdata: '{ITEM.LASTVALUE3}'
              priority: WARNING
              dependencies:
                - name: 'DevLine - {#NAME} Fail'
                  expression: 'last(/DevLine 8.3/devline.server[camera.{#NUM}.admin.state])=1 and last(/DevLine 8.3/devline.server[camera.{#NUM}.stream1.admin.state])=1 and last(/DevLine 8.3/devline.server[camera.{#NUM}.stream1.status])=0 and last(/DevLine 8.3/devline.server[camera.{#NUM}.stream2.admin.state])=1 and last(/DevLine 8.3/devline.server[camera.{#NUM}.stream2.status])=0'
              tags:
                - tag: Camera
                  value: '{#NAME}'
            - uuid: 602d6081ab454eb78b849851a7acfdb7
              expression: 'last(/DevLine 8.3/devline.server[camera.{#NUM}.admin.state])=1 and last(/DevLine 8.3/devline.server[camera.{#NUM}.stream2.admin.state])=1 and last(/DevLine 8.3/devline.server[camera.{#NUM}.stream2.status])=0'
              name: 'DevLine - {#NAME} Stream2 Fail'
              opdata: '{ITEM.LASTVALUE3}'
              priority: WARNING
              manual_close: 'YES'
              dependencies:
                - name: 'DevLine - {#NAME} Fail'
                  expression: 'last(/DevLine 8.3/devline.server[camera.{#NUM}.admin.state])=1 and last(/DevLine 8.3/devline.server[camera.{#NUM}.stream1.admin.state])=1 and last(/DevLine 8.3/devline.server[camera.{#NUM}.stream1.status])=0 and last(/DevLine 8.3/devline.server[camera.{#NUM}.stream2.admin.state])=1 and last(/DevLine 8.3/devline.server[camera.{#NUM}.stream2.status])=0'
              tags:
                - tag: Camera
                  value: '{#NAME}'
          master_item:
            key: 'devline.server[camera.all]'
          lld_macro_paths:
            - lld_macro: '{#NAME}'
              path: $.name
            - lld_macro: '{#NUM}'
              path: $.uri
          preprocessing:
            - type: STR_REPLACE
              parameters:
                - /cameras/
                - ''
        - uuid: c2f5f9aefa6f4a83a5490c8f1dc14904
          name: 'Storage discovery'
          type: DEPENDENT
          key: 'devline.server[storage.discovery]'
          delay: '0'
          lifetime: 14d
          item_prototypes:
            - uuid: 8c2944270e974b34bfebd518f05bb18e
              name: 'Devline - Storage {#PATH} days count'
              type: DEPENDENT
              key: 'devline.server[storage.{#PATH}.days]'
              delay: '0'
              units: days
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$.data[?(@.path == "{#PATH}")].archive.dates_count'
                  error_handler: CUSTOM_VALUE
                  error_handler_params: '0'
                - type: STR_REPLACE
                  parameters:
                    - '['
                    - ''
                - type: STR_REPLACE
                  parameters:
                    - ']'
                    - ''
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 24h
              master_item:
                key: 'devline.server[storage.state]'
              tags:
                - tag: Application
                  value: Storage
                - tag: Service
                  value: DevLine
                - tag: Storage
                  value: '{#PATH}'
            - uuid: 35695a85bb094d17ad0c1eb8915d86d2
              name: 'Devline - Storage {#PATH} free space'
              type: DEPENDENT
              key: 'devline.server[storage.{#PATH}.free_space]'
              delay: '0'
              units: b
              description: 'Объем свободного место в хранилище'
              valuemap:
                name: 'DevLine Storage Availability'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$.data[?(@.path == "{#PATH}")].free_space'
                - type: STR_REPLACE
                  parameters:
                    - '['
                    - ''
                - type: STR_REPLACE
                  parameters:
                    - ']'
                    - ''
                - type: MULTIPLIER
                  parameters:
                    - '1000000'
              master_item:
                key: 'devline.server[storage.state]'
              tags:
                - tag: Application
                  value: Storage
                - tag: Service
                  value: DevLine
                - tag: Storage
                  value: '{#PATH}'
            - uuid: 9ac82f5124724a46bcb7c9fe4b947f54
              name: 'Devline - Storage {#PATH} state'
              type: DEPENDENT
              key: 'devline.server[storage.{#PATH}.state]'
              delay: '0'
              description: 'Флаг доступности хранилища'
              valuemap:
                name: 'DevLine Storage Availability'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$.data[?(@.path == "{#PATH}")].available'
                - type: STR_REPLACE
                  parameters:
                    - '[true]'
                    - '1'
                - type: STR_REPLACE
                  parameters:
                    - '[false]'
                    - '2'
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 24h
              master_item:
                key: 'devline.server[storage.state]'
              tags:
                - tag: Application
                  value: Storage
                - tag: Service
                  value: DevLine
                - tag: Storage
                  value: '{#PATH}'
              trigger_prototypes:
                - uuid: dc3b6d9e82614b3e9345917fd52c9aac
                  expression: 'last(/DevLine 8.3/devline.server[storage.{#PATH}.state])=0'
                  name: 'Хранилище {#PATH} недоступно'
                  priority: HIGH
            - uuid: d48f838d1b894f0dabfe8baccfb6ad9b
              name: 'Devline - Storage {#PATH} write datarate'
              type: DEPENDENT
              key: 'devline.server[storage.{#PATH}.write.datarate]'
              delay: '0'
              value_type: FLOAT
              units: b/s
              description: 'Среднее за несколько последних секунд количество байт данных, поступающих на запись в хранилище'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$.data[?(@.path == "{#PATH}")].write.datarate'
                - type: STR_REPLACE
                  parameters:
                    - '['
                    - ''
                - type: STR_REPLACE
                  parameters:
                    - ']'
                    - ''
              master_item:
                key: 'devline.server[storage.state]'
              tags:
                - tag: Application
                  value: Storage
                - tag: Service
                  value: DevLine
                - tag: Storage
                  value: '{#PATH}'
            - uuid: d5baf46290c347199ed2f46ea48b1726
              name: 'Devline - Storage {#PATH} last error time'
              type: DEPENDENT
              key: 'devline.server[storage.{#PATH}.write.error]'
              delay: '0'
              value_type: CHAR
              trends: '0'
              description: |
                Время последней ошибки записи в хранилище в формате [год, месяц, день, час, минута, секунда, миллисекунда]
                Если элемент не обнаруживается, считаем, что всё хорошо
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$.data[?(@.path == "{#PATH}")].last_error_time'
                  error_handler: CUSTOM_VALUE
                  error_handler_params: '-'
                - type: STR_REPLACE
                  parameters:
                    - '['
                    - ''
                - type: STR_REPLACE
                  parameters:
                    - ']'
                    - ''
                - type: JAVASCRIPT
                  parameters:
                    - |
                      if (value == "-"){
                         return "OK";
                      }
                      
                      date = value.split(',');
                      
                      for (i = 0; i < date.length; i++){
                         if (date[i] < 10){
                            date[i] = "0" + date[i];
                         }
                      }
                      
                      return date[3] + ":" + date[4] + ":" + date[5] + "." + date[6] + " " + date[2] + "." + date[1] + "." + date[0];
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 24h
              master_item:
                key: 'devline.server[storage.state]'
              tags:
                - tag: Application
                  value: Storage
                - tag: Service
                  value: DevLine
                - tag: Storage
                  value: '{#PATH}'
              trigger_prototypes:
                - uuid: a2cf884c1f134133994937280beea8b7
                  expression: 'find(/DevLine 8.3/devline.server[storage.{#PATH}.write.error],,,"OK")=0'
                  name: 'Ошибка в хранилище {#PATH} (eq)'
                  priority: HIGH
                - uuid: f2e8c1963e934002b0a880b27b6a6b05
                  expression: 'find(/DevLine 8.3/devline.server[storage.{#PATH}.write.error],,"like","OK")=0'
                  name: 'Ошибка в хранилище {#PATH} (like)'
                  priority: HIGH
                - uuid: 8a93413737da40cc8020e8646b2e4399
                  expression: 'find(/DevLine 8.3/devline.server[storage.{#PATH}.write.error],,"ne","OK")=1'
                  name: 'Ошибка в хранилище {#PATH} (ne)'
                  priority: HIGH
            - uuid: 8abd507fa43d4ab1a011843f9469dfee
              name: 'Devline - Storage {#PATH} write queue'
              type: DEPENDENT
              key: 'devline.server[storage.{#PATH}.write.queue]'
              delay: '0'
              value_type: FLOAT
              units: b
              description: 'Максимальное за несколько последних секунд относительное значение размера очереди записи хранилища от максимально возможного'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$.data[?(@.path == "{#PATH}")].write.queue_size'
                - type: STR_REPLACE
                  parameters:
                    - '['
                    - ''
                - type: STR_REPLACE
                  parameters:
                    - ']'
                    - ''
              master_item:
                key: 'devline.server[storage.state]'
              tags:
                - tag: Application
                  value: Storage
                - tag: Service
                  value: DevLine
                - tag: Storage
                  value: '{#PATH}'
          master_item:
            key: 'devline.server[storage.state]'
          lld_macro_paths:
            - lld_macro: '{#PATH}'
              path: $.path
      macros:
        - macro: '{$DEVLINE_API_VER}'
          value: '82'
          description: 'На момент написания шаблона актуальная - это 82 версия. Но может быть другой'
        - macro: '{$DEVLINE_HTTP_PORT}'
          value: '9786'
          description: 'Порт для HTTP-запросов DevLine. По умолчанию - 9786 порт'
        - macro: '{$DEVLINE_LOGIN}'
          value: admin
        - macro: '{$DEVLINE_PASSWORD}'
          type: SECRET_TEXT
      valuemaps:
        - uuid: 30d519a6f26a47c38a2cdb1c9e250689
          name: 'Devline Camera Admin State'
          mappings:
            - value: '1'
              newvalue: Enabled
            - value: '0'
              newvalue: 'Off'
        - uuid: a5ad31ac35ee47d2b09f0ced233ffaef
          name: 'DevLine Demo State'
          mappings:
            - value: '1'
              newvalue: Demo
            - value: '0'
              newvalue: Commercial
        - uuid: 8df61fcbd2374787b93c7fd7acbf6700
          name: 'DevLine Storage Availability'
          mappings:
            - value: '1'
              newvalue: Available
            - value: '0'
              newvalue: Fail
        - uuid: f7b6fdaee6d946d8b4098136598ace7f
          name: 'DevLine Stream Status'
          mappings:
            - value: '1'
              newvalue: OK
            - value: '0'
              newvalue: Fail
